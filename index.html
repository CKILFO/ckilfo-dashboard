<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CKILFO Token Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>üî∑ CKILFO Token Dashboard</h1>
    <p><strong>Nom du token :</strong> CKILFO Token</p>
    <p><strong>Symbole :</strong> CKF</p>
    <p><strong>Proxy Address :</strong> 
      <a href="https://testnet.bscscan.com/address/0xABEa3d1c6BE1692d6559a59Ff3d9C4A17C012EfD" target="_blank">
        0xABEa3d1c6BE1692d6559a59Ff3d9C4A17C012EfD
      </a>
    </p>
    <p><strong>Impl√©mentation :</strong> 
      <a href="https://testnet.bscscan.com/address/0x3D4fec067a565966294f7df0E415C828ec2Cc2C9" target="_blank">
        0x3D4fec067a565966294f7df0E415C828ec2Cc2C9
      </a>
    </p>
    <p><strong>Code source v√©rifi√© :</strong> ‚úÖ</p>
    <p><strong>Total Supply :</strong> <span id="totalSupply">Chargement...</span></p>

    <hr>

    <h2>üìÖ V√©rifier le solde d'une adresse</h2>
    <input type="text" id="walletAddress" placeholder="Entrez une adresse BSC Testnet" style="width: 100%; padding: 10px; margin-top: 5px;">
    <button onclick="checkBalance()" style="margin-top: 10px; padding: 10px 20px;">V√©rifier le solde</button>
    <p><strong>Solde :</strong> <span id="balance">---</span></p>

    <hr>

    <h2>üè± Mint & Transfert de Tokens</h2>
    <button onclick="connectWallet()">Connecter Metamask</button>
    <p id="walletStatus">Portefeuille non connect√©</p>

    <input type="text" id="transferAddress" placeholder="Adresse de destination" style="width: 100%; padding: 10px; margin-top: 10px;">
    <input type="number" id="transferAmount" placeholder="Montant en CKF" style="width: 100%; padding: 10px; margin-top: 10px;">

    <button onclick="mintTokens()" style="margin-top: 10px; padding: 10px 20px;">Mint</button>
    <button onclick="transferTokens()" style="margin-top: 10px; padding: 10px 20px;">Transf√©rer</button>

    <p id="txStatus" style="margin-top:10px;color:#555;"></p>

    <br />
    <a href="https://testnet.bscscan.com/address/0x3D4fec067a565966294f7df0E415C828ec2Cc2C9#code" target="_blank">
      <img src="https://img.shields.io/badge/BscScan-Verified-green?style=for-the-badge&logo=binance" alt="BscScan Verified" />
    </a>
  </div>

  <script>
    const provider = new ethers.providers.JsonRpcProvider("https://data-seed-prebsc-1-s1.binance.org:8545/");
    const tokenAddress = "0xABEa3d1c6BE1692d6559a59Ff3d9C4A17C012EfD";
    const abi = [
      "function totalSupply() public view returns (uint256)",
      "function decimals() public view returns (uint8)",
      "function balanceOf(address account) public view returns (uint256)",
      "function mint(address to, uint256 amount) public",
      "function transfer(address to, uint256 amount) public returns (bool)"
    ];

    let signer;
    let contractWithSigner;

    async function connectWallet() {
      if (window.ethereum) {
        await window.ethereum.request({ method: "eth_requestAccounts" });
        const web3Provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = web3Provider.getSigner();
        contractWithSigner = new ethers.Contract(tokenAddress, abi, signer);
        const address = await signer.getAddress();
        document.getElementById("walletStatus").textContent = `Connect√© : ${address}`;
      } else {
        alert("Installez Metamask pour utiliser cette fonctionnalit√©.");
      }
    }

    async function loadTotalSupply() {
      try {
        const contract = new ethers.Contract(tokenAddress, abi, provider);
        const decimals = await contract.decimals();
        const rawSupply = await contract.totalSupply();
        const formattedSupply = ethers.utils.formatUnits(rawSupply, decimals);
        document.getElementById("totalSupply").textContent = formattedSupply + " CKF";
      } catch (err) {
        document.getElementById("totalSupply").textContent = "Erreur de chargement";
        console.error(err);
      }
    }

    async function checkBalance() {
      const address = document.getElementById("walletAddress").value;
      const status = document.getElementById("balance");
      status.style.color = "red";

      if (!ethers.utils.isAddress(address)) {
        status.textContent = "Adresse invalide";
        return;
      }
      try {
        const contract = new ethers.Contract(tokenAddress, abi, provider);
        const decimals = await contract.decimals();
        const rawBalance = await contract.balanceOf(address);
        const formattedBalance = ethers.utils.formatUnits(rawBalance, decimals);
        status.style.color = "green";
        status.textContent = formattedBalance + " CKF";
      } catch (err) {
        status.textContent = "Erreur lors de la lecture du solde.";
        console.error(err);
      }
    }

    async function mintTokens() {
      const to = document.getElementById("transferAddress").value;
      const amount = document.getElementById("transferAmount").value;
      const status = document.getElementById("txStatus");
      status.style.color = "red";

      if (!signer) {
        status.textContent = "‚ùå Veuillez connecter votre portefeuille Metamask.";
        return;
      }
      if (!ethers.utils.isAddress(to)) {
        status.textContent = "‚ùå Adresse BSC invalide.";
        return;
      }
      if (isNaN(amount) || Number(amount) <= 0) {
        status.textContent = "‚ùå Le montant doit √™tre sup√©rieur √† z√©ro.";
        return;
      }

      try {
        const decimals = await contractWithSigner.decimals();
        const amountInUnits = ethers.utils.parseUnits(amount, decimals);
        const tx = await contractWithSigner.mint(to, amountInUnits);
        await tx.wait();
        status.style.color = "green";
        status.textContent = "‚úÖ Mint r√©ussi !";
        loadTotalSupply();
      } catch (err) {
        status.textContent = "‚ùå Erreur : " + (err?.message?.split('\n')[0] || "√âchec de la transaction.");
        console.error(err);
      } finally {
        setTimeout(() => { status.textContent = ""; }, 8000);
      }
    }

    async function transferTokens() {
      const to = document.getElementById("transferAddress").value;
      const amount = document.getElementById("transferAmount").value;
      const status = document.getElementById("txStatus");
      status.style.color = "red";

      if (!signer) {
        status.textContent = "‚ùå Veuillez connecter votre portefeuille Metamask.";
        return;
      }
      if (!ethers.utils.isAddress(to)) {
        status.textContent = "‚ùå Adresse BSC invalide.";
        return;
      }
      if (isNaN(amount) || Number(amount) <= 0) {
        status.textContent = "‚ùå Le montant doit √™tre sup√©rieur √† z√©ro.";
        return;
      }

      try {
        const decimals = await contractWithSigner.decimals();
        const amountInUnits = ethers.utils.parseUnits(amount, decimals);
        const tx = await contractWithSigner.transfer(to, amountInUnits);
        await tx.wait();
        status.style.color = "green";
        status.textContent = "‚úÖ Transfert r√©ussi !";
      } catch (err) {
        status.textContent = "‚ùå Erreur : " + (err?.message?.split('\n')[0] || "√âchec de la transaction.");
        console.error(err);
      } finally {
        setTimeout(() => { status.textContent = ""; }, 8000);
      }
    }

    loadTotalSupply();
  </script>
</body>
</html>
