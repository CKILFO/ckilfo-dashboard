<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CKILFO Token Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>üî∑ CKILFO Token Dashboard</h1>
    <p><strong>Nom du token :</strong> CKILFO Token</p>
    <p><strong>Symbole :</strong> CKF</p>
    <p><strong>Proxy Address :</strong> 
      <a href="https://testnet.bscscan.com/address/0xABEa3d1c6BE1692d6559a59Ff3d9C4A17C012EfD" target="_blank">
        0xABEa3d1c6BE1692d6559a59Ff3d9C4A17C012EfD
      </a>
    </p>
    <p><strong>Impl√©mentation :</strong> 
      <a href="https://testnet.bscscan.com/address/0x3D4fec067a565966294f7df0E415C828ec2Cc2C9" target="_blank">
        0x3D4fec067a565966294f7df0E415C828ec2Cc2C9
      </a>
    </p>
    <p><strong>Code source v√©rifi√© :</strong> ‚úÖ</p>
    <p><strong>Total Supply :</strong> <span id="totalSupply">Chargement...</span></p>

    <hr>

    <h2>üìÖ V√©rifier le solde d'une adresse</h2>
    <input type="text" id="walletAddress" placeholder="Entrez une adresse BSC Testnet" style="width: 100%; padding: 10px; margin-top: 5px;">
    <button onclick="checkBalance()" style="margin-top: 10px; padding: 10px 20px;">V√©rifier le solde</button>
    <p><strong>Solde :</strong> <span id="balance">---</span></p>

    <hr>

    <h2>üè± Mint & Transfert de Tokens</h2>
    <button onclick="connectWallet()">Connecter Metamask</button>
    <p id="walletStatus">Portefeuille non connect√©</p>

    <input type="text" id="transferAddress" placeholder="Adresse de destination" style="width: 100%; padding: 10px; margin-top: 10px;">
    <input type="number" id="transferAmount" placeholder="Montant en CKF" style="width: 100%; padding: 10px; margin-top: 10px;">

    <button id="mintBtn" onclick="mintTokens()" style="margin-top: 10px; padding: 10px 20px;">Mint</button>
    <button onclick="transferTokens()" style="margin-top: 10px; padding: 10px 20px;">Transf√©rer</button>

    <p id="txStatus"></p>

    <br />
    <a href="https://testnet.bscscan.com/address/0x3D4fec067a565966294f7df0E415C828ec2Cc2C9#code" target="_blank">
      <img src="https://img.shields.io/badge/BscScan-Verified-green?style=for-the-badge&logo=binance" alt="BscScan Verified" />
    </a>
  </div>

  <script>
    const provider = new ethers.providers.JsonRpcProvider("https://data-seed-prebsc-1-s1.binance.org:8545/");
    const tokenAddress = "0xABEa3d1c6BE1692d6559a59Ff3d9C4A17C012EfD";
    const abi = [
      "function totalSupply() public view returns (uint256)",
      "function decimals() public view returns (uint8)",
      "function balanceOf(address account) public view returns (uint256)",
      "function mint(address to, uint256 amount) public",
      "function transfer(address to, uint256 amount) public returns (bool)",
      "function owner() public view returns (address)"
    ];

    let signer;
    let contractWithSigner;
    let isOwner = false;

    async function connectWallet() {
      if (window.ethereum) {
        await window.ethereum.request({ method: "eth_requestAccounts" });
        const web3Provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = web3Provider.getSigner();
        contractWithSigner = new ethers.Contract(tokenAddress, abi, signer);
        const userAddress = await signer.getAddress();
        const ownerAddress = await contractWithSigner.owner();

        if (userAddress.toLowerCase() === ownerAddress.toLowerCase()) {
          isOwner = true;
          document.getElementById("walletStatus").textContent = `Connect√© : ${userAddress} ‚úÖ (Owner)`;
        } else {
          isOwner = false;
          document.getElementById("walletStatus").textContent = `Connect√© : ${userAddress} (Non-owner)`;
          document.getElementById("mintBtn").disabled = true;
        }
      } else {
        alert("Installez Metamask pour utiliser cette fonctionnalit√©.");
      }
    }

    async function loadTotalSupply() {
      try {
        const contract = new ethers.Contract(tokenAddress, abi, provider);
        const decimals = await contract.decimals();
        const rawSupply = await contract.totalSupply();
        const formattedSupply = ethers.utils.formatUnits(rawSupply, decimals);
        document.getElementById("totalSupply").textContent = formattedSupply + " CKF";
      } catch (err) {
        document.getElementById("totalSupply").textContent = "Erreur de chargement";
        console.error(err);
      }
    }

    async function checkBalance() {
      const address = document.getElementById("walletAddress").value;
      if (!ethers.utils.isAddress(address)) {
        document.getElementById("balance").textContent = "Adresse invalide";
        return;
      }
      try {
        const contract = new ethers.Contract(tokenAddress, abi, provider);
        const decimals = await contract.decimals();
        const rawBalance = await contract.balanceOf(address);
        const formattedBalance = ethers.utils.formatUnits(rawBalance, decimals);
        document.getElementById("balance").textContent = formattedBalance + " CKF";
      } catch (err) {
        document.getElementById("balance").textContent = "Erreur";
        console.error(err);
      }
    }

    async function mintTokens() {
      if (!isOwner) {
        alert("Seul le propri√©taire peut mint des tokens.");
        return;
      }
      const to = document.getElementById("transferAddress").value;
      const amount = document.getElementById("transferAmount").value;
      if (!signer || !ethers.utils.isAddress(to)) {
        document.getElementById("txStatus").textContent = "Portefeuille non connect√© ou adresse invalide.";
        return;
      }
      try {
        const decimals = await contractWithSigner.decimals();
        const amountInUnits = ethers.utils.parseUnits(amount, decimals);
        const tx = await contractWithSigner.mint(to, amountInUnits);
        await tx.wait();
        document.getElementById("txStatus").textContent = "Mint r√©ussi !";
        loadTotalSupply();
      } catch (err) {
        document.getElementById("txStatus").textContent = "Erreur lors du mint.";
        console.error(err);
      }
    }

    async function transferTokens() {
      const to = document.getElementById("transferAddress").value;
      const amount = document.getElementById("transferAmount").value;
      if (!signer || !ethers.utils.isAddress(to)) {
        document.getElementById("txStatus").textContent = "Portefeuille non connect√© ou adresse invalide.";
        return;
      }
      try {
        const decimals = await contractWithSigner.decimals();
        const amountInUnits = ethers.utils.parseUnits(amount, decimals);
        const tx = await contractWithSigner.transfer(to, amountInUnits);
        await tx.wait();
        document.getElementById("txStatus").textContent = "Transfert r√©ussi !";
      } catch (err) {
        document.getElementById("txStatus").textContent = "Erreur lors du transfert.";
        console.error(err);
      }
    }

    loadTotalSupply();
  </script>
</body>
</html>
